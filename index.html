<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ITACHIIXT</title>
  <meta name="description" content="ITACHIIXT AI-powered prediction engine with pattern analysis">
  <meta name="theme-color" content="#00D9A6">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Lexend:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    :root{
      --background:240 20% 4%;--foreground:220 15% 90%;
      --card:240 18% 8%;--card-foreground:220 15% 90%;
      --primary:170 100% 42%;--primary-foreground:240 20% 4%;
      --secondary:335 85% 58%;--secondary-foreground:0 0% 100%;
      --muted:240 15% 14%;--muted-foreground:225 12% 48%;
      --accent:40 100% 55%;--accent-foreground:240 20% 4%;
      --destructive:0 85% 55%;--success:150 100% 42%;
      --pending:40 100% 55%;--jackpot:275 80% 58%;
      --border:240 18% 16%
    }
    body{font-family:'Lexend',sans-serif;background:hsl(var(--background));color:hsl(var(--foreground));min-height:100vh;-webkit-font-smoothing:antialiased;overflow-x:hidden}
    .font-display{font-family:'Rajdhani',sans-serif;font-weight:700}
    .font-mono{font-family:'Share Tech Mono',monospace}
    .glass{background:hsla(240,18%,8%,0.7);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid hsla(240,18%,16%,0.5);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.05)}
    .gradient-text{background:linear-gradient(135deg,hsl(170,100%,42%),hsl(40,100%,55%),hsl(335,85%,58%));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;background-size:200% 200%;animation:gradient-shift 3s ease infinite}
    .ball-purple{background:linear-gradient(135deg,hsla(275,80%,58%,0.8),hsl(275,80%,58%),hsla(275,80%,58%,0.6))}
    .ball-red{background:linear-gradient(135deg,hsla(0,85%,55%,0.8),hsl(0,85%,55%),hsla(0,85%,55%,0.6))}
    .ball-green{background:linear-gradient(135deg,hsla(150,100%,42%,0.8),hsl(150,100%,42%),hsla(150,100%,42%,0.6))}
    .si-primary{background:linear-gradient(135deg,hsl(170,100%,42%),hsla(170,100%,42%,0.6))}
    .si-accent{background:linear-gradient(135deg,hsl(40,100%,55%),hsla(40,100%,55%,0.6))}
    .si-secondary{background:linear-gradient(135deg,hsl(335,85%,58%),hsla(335,85%,58%,0.6))}
    .rainbow-ring{background:linear-gradient(90deg,#ff0000,#ff8000,#ffff00,#80ff00,#00ff00,#00ff80,#00ffff,#0080ff,#0000ff,#8000ff,#ff00ff,#ff0080,#ff0000);background-size:400% 400%;animation:rainbow-border 3s ease infinite}

    @keyframes gradient-shift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    @keyframes float-up{0%{transform:translateY(0) scale(1);opacity:0.4}100%{transform:translateY(-110vh) scale(1.5);opacity:0}}
    @keyframes rainbow-border{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    @keyframes spin-slow{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    @keyframes loader-orbit{0%{transform:rotate(0deg) translateX(40px) rotate(0deg)}100%{transform:rotate(360deg) translateX(40px) rotate(-360deg)}}
    @keyframes loader-pulse{0%,100%{transform:scale(0.8);opacity:0.5}50%{transform:scale(1.2);opacity:1}}
    @keyframes status-glow{0%,100%{opacity:1}50%{opacity:0.6}}
    @keyframes fade-in{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}
    .animate-fade-in{animation:fade-in 0.5s ease-out}

    .bubbles{position:fixed;inset:0;overflow:hidden;pointer-events:none;z-index:0}
    .bubbles span{position:absolute;bottom:-150px;border-radius:50%;width:60px;height:60px}
    .page{display:none}.page.active{display:block}
    .hidden{display:none!important}

    .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:hsla(240,18%,8%,0.9);backdrop-filter:blur(16px);border-top:1px solid hsla(240,18%,16%,0.5);padding:12px 0;z-index:50;display:flex;justify-content:space-around}
    .nav-btn{display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;padding:8px;cursor:pointer;color:hsl(var(--muted-foreground));font-size:10px;font-family:'Lexend',sans-serif;transition:color 0.3s}
    .nav-btn.active{color:hsl(var(--primary))}.nav-btn:hover{color:hsl(var(--primary))}

    .server-card{position:relative;padding:16px;background:hsla(240,18%,8%,0.4);border:2px solid transparent;border-radius:16px;cursor:pointer;text-align:center;transition:all 0.3s;backdrop-filter:blur(8px)}
    .server-card:hover{background:hsla(240,18%,8%,0.6)}
    .server-card.active-primary{border-color:hsl(var(--primary))}
    .server-card.active-accent{border-color:hsl(var(--accent))}
    .server-card.active-secondary{border-color:hsl(var(--secondary))}
    .server-icon{width:40px;height:40px;border-radius:50%;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;color:hsl(var(--primary-foreground))}
    .active-dot{position:absolute;top:8px;right:8px;width:8px;height:8px;border-radius:50%;animation:status-glow 1.5s infinite;display:none}
    .dot-1{background:hsl(var(--primary))}.dot-2{background:hsl(var(--accent))}.dot-3{background:hsl(var(--secondary))}

    .loader-container{display:flex;flex-direction:column;align-items:center;gap:24px;padding:32px 0}
    .loader-ring{position:relative;width:96px;height:96px}
    .loader-ring .outer{position:absolute;inset:0;border-radius:50%;border:2px solid transparent;border-top-color:hsl(var(--primary));border-right-color:hsl(var(--accent));animation:spin-slow 1.5s linear infinite}
    .loader-ring .inner{position:absolute;inset:8px;border-radius:50%;border:2px solid transparent;border-bottom-color:hsl(var(--secondary));border-left-color:hsl(var(--primary));animation:spin-slow 1s linear infinite reverse}
    .loader-ring .pulse{position:absolute;inset:24px;border-radius:50%;background:hsla(170,100%,42%,0.2);animation:loader-pulse 1s ease-in-out infinite}
    .orbit-dot{position:absolute;width:12px;height:12px;border-radius:50%;top:50%;left:50%;margin:-6px 0 0 -6px}
    .od-0{background:hsl(var(--primary));animation:loader-orbit 1.2s 0s linear infinite}
    .od-1{background:hsl(var(--accent));animation:loader-orbit 1.5s 0.2s linear infinite}
    .od-2{background:hsl(var(--secondary));animation:loader-orbit 1.8s 0.4s linear infinite}

    .login-input{width:100%;padding:16px;background:hsla(240,15%,14%,0.5);border:1px solid hsla(240,18%,16%,0.5);border-radius:16px;font-size:1.1rem;text-align:center;letter-spacing:4px;color:hsl(var(--foreground));outline:none;transition:all 0.3s;font-family:'Share Tech Mono',monospace}
    .login-input::placeholder{color:hsl(var(--muted-foreground))}
    .login-input:focus{border-color:hsl(var(--primary));box-shadow:0 0 20px hsla(170,100%,42%,0.3)}
    .btn-primary{width:100%;padding:16px;border:none;border-radius:50px;font-size:1.1rem;font-weight:bold;color:hsl(var(--primary-foreground));background:linear-gradient(135deg,hsl(var(--primary)),hsl(var(--accent)));cursor:pointer;transition:all 0.3s;font-family:'Rajdhani',sans-serif}
    .btn-primary:hover{opacity:0.9;transform:scale(1.02)}.btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .btn-telegram{width:100%;padding:16px;border:none;border-radius:50px;font-size:1.1rem;font-weight:bold;color:hsl(var(--primary-foreground));background:linear-gradient(135deg,hsl(200,100%,40%),hsl(200,100%,48%));cursor:pointer;transition:all 0.3s;font-family:'Rajdhani',sans-serif;display:flex;align-items:center;justify-content:center;gap:10px;text-decoration:none;margin-top:16px}
    .btn-telegram:hover{opacity:0.9;transform:scale(1.02)}
    .icon-btn{background:hsla(240,15%,14%,0.5);border:none;padding:8px;border-radius:50%;cursor:pointer;color:hsl(var(--foreground));transition:all 0.3s;width:40px;height:40px;display:flex;align-items:center;justify-content:center;position:absolute;right:16px;top:50%;transform:translateY(-50%)}
    .icon-btn:hover{background:hsl(var(--muted))}
    .container{width:100%;max-width:500px;margin:0 auto;padding:20px}

    .webview-wrap{position:fixed;inset:0;z-index:10;padding-bottom:72px}
    .webview-wrap iframe{width:100%;height:100%;border:0}
    .search-bar-wrap{position:fixed;top:16px;left:16px;right:16px;z-index:20;display:flex;gap:8px}
    .search-input{flex:1;padding:12px 16px;background:hsla(240,18%,8%,0.9);backdrop-filter:blur(8px);border:1px solid hsla(240,18%,16%,0.5);border-radius:16px;font-size:14px;color:hsl(var(--foreground));outline:none;font-family:'Lexend',sans-serif}
    .search-input:focus{border-color:hsl(var(--primary))}
    .search-go{background:linear-gradient(135deg,hsl(var(--primary)),hsl(var(--accent)));color:hsl(var(--primary-foreground));border:none;padding:12px;border-radius:16px;cursor:pointer}
    .unhide-btn{position:fixed;top:16px;right:16px;z-index:20;background:hsla(240,18%,8%,0.9);backdrop-filter:blur(8px);border:none;padding:12px;border-radius:50%;cursor:pointer;color:hsl(var(--primary));box-shadow:0 4px 15px rgba(0,0,0,0.3);display:none}
    svg{display:inline-block;vertical-align:middle}
  </style>
</head>
<body>

<div class="bubbles" id="bubbles"></div>

<!-- LOGIN -->
<div id="loginPage" class="page active">
  <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;position:relative;z-index:1">
    <div class="glass animate-fade-in" style="width:100%;max-width:400px;padding:32px">
      <h1 class="gradient-text font-display" style="font-size:1.8rem;text-align:center;margin-bottom:8px">ITACHIIXT</h1>
      <p style="text-align:center;color:hsl(var(--muted-foreground));font-size:0.9rem;margin-bottom:32px">Enter your access key to continue</p>
      <form id="loginForm">
        <input type="text" id="keyInput" class="login-input" placeholder="ENTER KEY" autocomplete="off">
        <p id="loginError" style="color:hsl(var(--destructive));text-align:center;font-size:0.85rem;margin-top:12px;font-weight:500;display:none"></p>
        <button type="submit" id="loginBtn" class="btn-primary" style="margin-top:24px">UNLOCK</button>
      </form>
      <a href="https://t.me/ITACHIIXT" target="_blank" rel="noopener noreferrer" class="btn-telegram">TELEGRAM</a>
      <p style="text-align:center;font-size:0.75rem;color:hsl(var(--muted-foreground));margin-top:24px">TELEGRAM USERNAME BY TEAM - ITACHIIXT</p>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage" class="page">
  <div style="position:relative;z-index:1;padding-bottom:96px;min-height:100vh">
    <div class="container">
      <header class="glass animate-fade-in" style="text-align:center;padding:20px;margin-bottom:20px;position:relative">
        <button class="icon-btn" id="logoutBtn" title="Logout">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" x2="12" y1="2" y2="12"/></svg>
        </button>
        <h1 class="gradient-text font-display" style="font-size:1.25rem">ITACHIIXT</h1>
      </header>

      <div class="glass animate-fade-in" style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;margin-bottom:20px">
        <div style="font-size:0.9rem;font-weight:600;color:hsl(var(--muted-foreground))">WINGO NO - <span id="period" class="font-mono" style="color:hsl(var(--foreground))">--</span></div>
        <div id="timer" class="font-mono" style="font-size:1.8rem;font-weight:bold;color:hsl(var(--accent))">00</div>
      </div>

      <section class="glass animate-fade-in" style="padding:16px 20px;margin-bottom:20px">
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;text-align:center">
          <div><span style="font-size:0.6rem;color:hsl(var(--muted-foreground));display:block;margin-bottom:4px">TOTAL</span><span id="totalStat" class="font-mono" style="font-size:0.9rem;font-weight:bold">0</span></div>
          <div><span style="font-size:0.6rem;color:hsl(var(--muted-foreground));display:block;margin-bottom:4px">VICTORY</span><span id="winStat" class="font-mono" style="font-size:0.9rem;font-weight:bold;color:hsl(var(--success))">0</span></div>
          <div><span style="font-size:0.6rem;color:hsl(var(--muted-foreground));display:block;margin-bottom:4px">DEFEAT</span><span id="lossStat" class="font-mono" style="font-size:0.9rem;font-weight:bold;color:hsl(var(--destructive))">0</span></div>
          <div><span style="font-size:0.6rem;color:hsl(var(--muted-foreground));display:block;margin-bottom:4px">JACKPOT</span><span id="jackpotStat" class="font-mono" style="font-size:0.9rem;font-weight:bold;color:hsl(var(--jackpot))">0</span></div>
          <div><span style="font-size:0.6rem;color:hsl(var(--muted-foreground));display:block;margin-bottom:4px">WIN RATE</span><span id="rateStat" class="font-mono" style="font-size:0.9rem;font-weight:bold;color:hsl(var(--primary))">0.0%</span></div>
        </div>
      </section>

      <section class="glass animate-fade-in" style="padding:24px;margin-bottom:20px;text-align:center">
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px" id="serverGrid">
          <div class="server-card active-primary" data-server="server1">
            <div class="active-dot dot-1" id="dot1" style="display:block"></div>
            <div class="server-icon si-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="8" x="2" y="2" rx="2"/><rect width="20" height="8" x="2" y="14" rx="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
            </div>
            <p class="font-display" style="font-size:0.6rem;color:hsl(var(--foreground));letter-spacing:2px">NEURAL NET</p>
          </div>
          <div class="server-card" data-server="server2">
            <div class="active-dot dot-2" id="dot2"></div>
            <div class="server-icon si-accent">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4.5a2.5 2.5 0 0 0-4.96-.46 2.5 2.5 0 0 0-1.98 3 2.5 2.5 0 0 0 1.32 4.24 3 3 0 0 0 .34 5.58 2.5 2.5 0 0 0 2.96 3.08A2.5 2.5 0 0 0 12 19.5a2.5 2.5 0 0 0 2.32.64 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0 1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 12 4.5"/></svg>
            </div>
            <p class="font-display" style="font-size:0.6rem;color:hsl(var(--foreground));letter-spacing:2px">QUANTUM AI</p>
          </div>
          <div class="server-card" data-server="server3">
            <div class="active-dot dot-3" id="dot3"></div>
            <div class="server-icon si-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>
            </div>
            <p class="font-display" style="font-size:0.6rem;color:hsl(var(--foreground));letter-spacing:2px">DEEP TRADE</p>
          </div>
        </div>

        <div id="predictionArea"></div>
        <div id="loadingArea" class="hidden">
          <div class="loader-container">
            <div class="loader-ring">
              <div class="outer"></div>
              <div class="inner"></div>
              <div class="pulse"></div>
              <div class="orbit-dot od-0"></div>
              <div class="orbit-dot od-1"></div>
              <div class="orbit-dot od-2"></div>
            </div>
            <p id="loadingLabel" class="font-display" style="font-size:0.85rem;color:hsl(var(--primary));letter-spacing:3px">ANALYZING...</p>
          </div>
        </div>
        <div id="resultArea" class="hidden">
          <div style="padding:24px 0;display:flex;justify-content:center;align-items:center;gap:24px">
            <div style="position:relative;width:80px;height:80px">
              <div class="rainbow-ring" style="position:absolute;inset:0;border-radius:50%;padding:3px">
                <div id="sideBall" class="font-mono" style="width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:900;background:hsl(var(--card));color:hsl(var(--primary))">B</div>
              </div>
            </div>
            <div id="numberBall" class="font-mono ball-purple" style="width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:bold;color:hsl(var(--foreground));box-shadow:0 4px 15px rgba(0,0,0,0.3)">5</div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- WEBSITE -->
<div id="websitePage" class="page">
  <div id="webviewWrap" class="webview-wrap hidden">
    <iframe id="webviewFrame" title="Webview" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-presentation" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
  </div>
  <form id="searchBarForm" class="search-bar-wrap">
    <input type="text" id="searchInput" class="search-input" placeholder="Enter URL or search" autocomplete="off">
    <button type="submit" class="search-go">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
    </button>
  </form>
  <button id="unhideBtn" class="unhide-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
  </button>
</div>

<!-- BOTTOM NAV -->
<nav id="bottomNav" class="bottom-nav hidden">
  <button class="nav-btn active" data-page="dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Home</span>
  </button>
  <button class="nav-btn" data-page="website">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
    <span>Website</span>
  </button>
</nav>

<script>
// ─── CONFIG ───
const FIREBASE_DATABASE_URL = 'https://maqsad-758501-default-rtdb.firebaseio.com';
const HISTORY_API = 'https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json';
const LOADING_LABELS = ['ANALYZING...','PROCESSING...','CALCULATING...','PREDICTING...'];

// ─── DETERMINISTIC PRNGs ───
function mulberry32(seed) {
  let t = (seed + 0x6d2b79f5) | 0;
  t = Math.imul(t ^ (t >>> 15), t | 1);
  t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
  return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
}
function fnv1a(str) {
  let hash = 2166136261;
  for (let i = 0; i < str.length; i++) { hash ^= str.charCodeAt(i); hash = Math.imul(hash, 16777619); }
  return (hash >>> 0) / 4294967296;
}
function xorshift32(seed) {
  let x = seed | 1; x ^= x << 13; x ^= x >> 17; x ^= x << 5;
  return ((x >>> 0) % 10000) / 10000;
}
function hashString(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash = hash & hash; }
  return Math.abs(hash);
}
function getRecentNumbers(history, count) {
  count = count || 10;
  return history.slice(0, count).map(function(item) { return parseInt(item.number, 10); });
}

// ─── Server 1: Neural Pattern Analysis ───
function neuralPatternPrediction(period, history) {
  var periodNum = parseInt(period.slice(-5), 10);
  var recent = getRecentNumbers(history);
  var historyHash = recent.length > 0 ? hashString(recent.join(',')) : 0;
  var combinedSeed = periodNum + historyHash;
  var patternScore = mulberry32(combinedSeed);
  var numberSeed = mulberry32(combinedSeed + 7777);
  var bigProb = 0.5;
  if (recent.length > 0) {
    var streak = 1, lastSide = recent[0] >= 5 ? 'BIG' : 'SMALL';
    var bigCount = recent[0] >= 5 ? 1 : 0, sum = recent[0];
    for (var i = 1; i < recent.length; i++) {
      var s = recent[i] >= 5 ? 'BIG' : 'SMALL';
      if (s === 'BIG') bigCount++;
      sum += recent[i];
      if (s === lastSide) streak++; else { streak = 1; lastSide = s; }
    }
    if (streak >= 3 && lastSide === 'BIG') bigProb -= 0.15;
    else if (streak >= 3 && lastSide === 'SMALL') bigProb += 0.15;
    var ratio = bigCount / recent.length;
    if (ratio > 0.7) bigProb -= 0.1; else if (ratio < 0.3) bigProb += 0.1;
    var avg = sum / recent.length;
    if (avg > 6) bigProb -= 0.05; else if (avg < 3) bigProb += 0.05;
  }
  var side = patternScore < bigProb ? 'BIG' : 'SMALL';
  var pool = side === 'BIG' ? [5,6,7,8,9] : [0,1,2,3,4];
  return { side: side, number: pool[Math.floor(numberSeed * pool.length)] };
}

// ─── Server 2: Quantum API Engine ───
function quantumEnginePrediction(period, history) {
  var recent = getRecentNumbers(history);
  var seedStr = period + ':' + recent.join('-') + ':QE_V2';
  var primaryHash = fnv1a(seedStr);
  var secondaryHash = fnv1a(seedStr + ':NUM');
  var bigProb = 0.5;
  if (recent.length >= 3) {
    var freq = new Array(10).fill(0);
    recent.forEach(function(n) { freq[n]++; });
    var maxFreq = Math.max.apply(null, freq);
    var hotNumber = freq.indexOf(maxFreq);
    if (hotNumber >= 5) bigProb += 0.08; else bigProb -= 0.08;
    var alternations = 0;
    for (var i = 1; i < recent.length; i++) {
      if ((recent[i] >= 5) !== (recent[i-1] >= 5)) alternations++;
    }
    var altRatio = alternations / (recent.length - 1);
    if (altRatio > 0.6) bigProb = recent[0] >= 5 ? 0.35 : 0.65;
    var sum = recent.reduce(function(a, b) { return a + b; }, 0);
    bigProb += ((sum % 7) - 3) * 0.02;
  }
  bigProb = Math.max(0.15, Math.min(0.85, bigProb));
  var side = primaryHash < bigProb ? 'BIG' : 'SMALL';
  var pool = side === 'BIG' ? [5,6,7,8,9] : [0,1,2,3,4];
  return { side: side, number: pool[Math.floor(secondaryHash * pool.length)] };
}

// ─── Server 3: Deep Trade Algorithm ───
function deepTradePrediction(period, history) {
  var periodNum = parseInt(period.slice(-5), 10);
  var recent = getRecentNumbers(history);
  var baseSeed = periodNum * 31337 + (recent.length > 0 ? hashString(recent.slice(0, 5).join('')) : 0);
  var score = xorshift32(baseSeed);
  var numScore = xorshift32(baseSeed + 54321);
  var bigProb = 0.5;
  if (recent.length >= 4) {
    var weights = [0.35, 0.25, 0.2, 0.12, 0.08];
    var momentum = 0;
    for (var i = 0; i < Math.min(recent.length, 5); i++) {
      momentum += (recent[i] >= 5 ? 1 : -1) * (weights[i] || 0.05);
    }
    if (momentum > 0.5) bigProb -= 0.18;
    else if (momentum < -0.5) bigProb += 0.18;
    else bigProb += momentum * 0.1;
    var diffs = [];
    for (var j = 1; j < Math.min(recent.length, 6); j++) {
      diffs.push(Math.abs(recent[j] - recent[j-1]));
    }
    var avgDiff = diffs.reduce(function(a, b) { return a + b; }, 0) / diffs.length;
    if (avgDiff > 5) bigProb += 0.05; else if (avgDiff < 2) bigProb -= 0.05;
    var last3 = recent.slice(0, 3);
    var allSame = last3.every(function(n) { return (n >= 5) === (last3[0] >= 5); });
    if (allSame && last3[0] >= 5) bigProb -= 0.12;
    else if (allSame) bigProb += 0.12;
  }
  bigProb = Math.max(0.1, Math.min(0.9, bigProb));
  var side = score < bigProb ? 'BIG' : 'SMALL';
  var pool = side === 'BIG' ? [5,6,7,8,9] : [0,1,2,3,4];
  return { side: side, number: pool[Math.floor(numScore * pool.length)] };
}

function getPredictionForServer(period, server, history) {
  switch (server) {
    case 'server1': return neuralPatternPrediction(period, history);
    case 'server2': return quantumEnginePrediction(period, history);
    case 'server3': return deepTradePrediction(period, history);
    default: return neuralPatternPrediction(period, history);
  }
}

// ─── UTILITIES ───
function getPeriod() {
  var u = new Date();
  var y = u.getUTCFullYear(), m = String(u.getUTCMonth()+1).padStart(2,'0'), d = String(u.getUTCDate()).padStart(2,'0');
  return y+''+m+''+d+'1000'+(10001 + u.getUTCHours()*60 + u.getUTCMinutes());
}
function getRemainingSeconds() { return 60 - new Date().getUTCSeconds(); }
function getBallColor(n) { if (n===0||n===5) return 'purple'; if (n%2===0) return 'red'; return 'green'; }

// ─── AUTH ───
function getDeviceId() {
  var stored = localStorage.getItem('deviceId');
  if (stored) return stored;
  var c = document.createElement('canvas'), ctx = c.getContext('2d');
  if (ctx) { ctx.textBaseline='top'; ctx.font='14px Arial'; ctx.fillText('device-fingerprint',2,2); }
  var fp = [navigator.userAgent,navigator.language,screen.width,screen.height,screen.colorDepth,new Date().getTimezoneOffset(),c.toDataURL(),navigator.hardwareConcurrency||'unknown'].join('|');
  var h=0; for(var i=0;i<fp.length;i++){h=((h<<5)-h)+fp.charCodeAt(i);h=h&h;}
  var id='DEV_'+Math.abs(h).toString(36).toUpperCase()+'_'+Date.now().toString(36).toUpperCase();
  localStorage.setItem('deviceId',id); return id;
}
async function validateKey(inputKey) {
  try {
    var deviceId = getDeviceId();
    var res = await fetch(FIREBASE_DATABASE_URL+'/keys.json');
    var keys = await res.json();
    if (!keys) return {valid:false,message:'No keys found in database'};
    for (var keyId in keys) {
      var kd = keys[keyId];
      if (kd.key === inputKey || keyId === inputKey) {
        if (kd.isActive === false) return {valid:false,message:'Key has been deactivated'};
        var exp = kd.expiresAt || kd.expiry;
        if (exp && Date.now() > exp) return {valid:false,message:'Key has expired'};
        if (kd.boundDevice) { if (kd.boundDevice !== deviceId) return {valid:false,message:'Key is already bound to another device'}; }
        else { await fetch(FIREBASE_DATABASE_URL+'/keys/'+keyId+'.json',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({boundDevice:deviceId,boundAt:Date.now()})}); }
        return {valid:true};
      }
    }
    return {valid:false,message:'Invalid key'};
  } catch(e) { return {valid:false,message:'Connection error. Please try again.'}; }
}
async function fetchHistory() {
  try { var res = await fetch(HISTORY_API); var data = await res.json(); return (data && data.data && data.data.list) ? data.data.list : []; }
  catch(e) { return []; }
}

// ─── STATE ───
var historyData = [];
var apiHistoryCache = [];
var selectedServer = localStorage.getItem('selectedServer') || 'server1';
var currentPeriod = '';
var lastPredictedPeriod = '';
var isLoading = false;
var loadingInterval = null;

// ─── BUBBLES ───
var bubblesEl = document.getElementById('bubbles');
[
  {left:'5%',dur:'18s',del:'0s',col:'170,100%,42%'},
  {left:'20%',dur:'22s',del:'2s',col:'335,85%,58%'},
  {left:'35%',dur:'26s',del:'4s',col:'275,80%,58%'},
  {left:'50%',dur:'20s',del:'1s',col:'40,100%,55%'},
  {left:'65%',dur:'24s',del:'3s',col:'220,80%,55%'},
  {left:'80%',dur:'30s',del:'5s',col:'170,70%,50%'},
].forEach(function(b) {
  var s = document.createElement('span');
  s.style.cssText = 'left:'+b.left+';background:radial-gradient(circle,hsla('+b.col+',0.3),hsla('+b.col+',0.05));animation:float-up '+b.dur+' '+b.del+' infinite ease-in';
  bubblesEl.appendChild(s);
});

// ─── NAVIGATION ───
function showPage(name) {
  document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
  document.querySelectorAll('.nav-btn').forEach(function(n) { n.classList.remove('active'); });
  document.getElementById(name + 'Page').classList.add('active');
  var navBtn = document.querySelector('.nav-btn[data-page="'+name+'"]');
  if (navBtn) navBtn.classList.add('active');
}
document.querySelectorAll('.nav-btn').forEach(function(btn) {
  btn.addEventListener('click', function() { showPage(btn.dataset.page); });
});

// ─── LOGIN ───
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  var key = document.getElementById('keyInput').value.trim().toUpperCase();
  var btn = document.getElementById('loginBtn');
  var err = document.getElementById('loginError');
  if (!key) { err.textContent = '* PLEASE ENTER A KEY *'; err.style.display = 'block'; return; }
  btn.textContent = 'VERIFYING...'; btn.disabled = true; err.style.display = 'none';
  var result = await validateKey(key);
  if (result.valid) {
    localStorage.removeItem('historyData'); historyData = [];
    sessionStorage.setItem('isLoggedIn', 'true'); sessionStorage.setItem('userKey', key);
    document.getElementById('bottomNav').classList.remove('hidden');
    showPage('dashboard'); initDashboard();
  } else {
    err.textContent = '* ' + (result.message||'INVALID KEY').toUpperCase() + ' *'; err.style.display = 'block';
    btn.textContent = 'UNLOCK'; btn.disabled = false;
  }
});

// ─── LOGOUT ───
document.getElementById('logoutBtn').addEventListener('click', function() {
  sessionStorage.clear(); localStorage.removeItem('historyData'); location.reload();
});

// ─── SERVER SELECTION ───
var serverActiveClasses = { server1: 'active-primary', server2: 'active-accent', server3: 'active-secondary' };
document.getElementById('serverGrid').addEventListener('click', function(e) {
  var card = e.target.closest('.server-card');
  if (!card) return;
  selectedServer = card.dataset.server;
  localStorage.setItem('selectedServer', selectedServer);
  document.querySelectorAll('.server-card').forEach(function(c) {
    c.className = 'server-card' + (c.dataset.server === selectedServer ? ' ' + serverActiveClasses[selectedServer] : '');
  });
  document.getElementById('dot1').style.display = selectedServer === 'server1' ? 'block' : 'none';
  document.getElementById('dot2').style.display = selectedServer === 'server2' ? 'block' : 'none';
  document.getElementById('dot3').style.display = selectedServer === 'server3' ? 'block' : 'none';
  if (lastPredictedPeriod === currentPeriod && !isLoading) {
    lastPredictedPeriod = '';
    runAutoPrediction(currentPeriod);
  }
});

// ─── PREDICTION DISPLAY ───
function showResult(p) {
  var sb = document.getElementById('sideBall');
  sb.textContent = p.side === 'BIG' ? 'B' : 'S';
  sb.style.color = p.side === 'BIG' ? 'hsl(var(--primary))' : 'hsl(var(--accent))';
  var nb = document.getElementById('numberBall');
  nb.textContent = p.number;
  nb.className = 'font-mono ball-' + getBallColor(p.number);
  nb.style.cssText = 'width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:bold;color:hsl(var(--foreground));box-shadow:0 4px 15px rgba(0,0,0,0.3)';
}

async function runAutoPrediction(period) {
  if (isLoading || lastPredictedPeriod === period) return;
  isLoading = true;
  document.getElementById('predictionArea').classList.add('hidden');
  document.getElementById('loadingArea').classList.remove('hidden');
  document.getElementById('resultArea').classList.add('hidden');
  var freshHistory = await fetchHistory();
  if (freshHistory.length > 0) apiHistoryCache = freshHistory;
  var step = 0;
  document.getElementById('loadingLabel').textContent = LOADING_LABELS[0];
  loadingInterval = setInterval(function() {
    step = (step + 1) % 4;
    document.getElementById('loadingLabel').textContent = LOADING_LABELS[step];
  }, 1250);
  setTimeout(function() {
    clearInterval(loadingInterval);
    var p = getPredictionForServer(period, selectedServer, apiHistoryCache);
    lastPredictedPeriod = period;
    isLoading = false;
    document.getElementById('loadingArea').classList.add('hidden');
    showResult(p);
    document.getElementById('resultArea').classList.remove('hidden');
    var entry = { period: period, predicted: p.side, predictedNum: p.number, status: 'PENDING', server: selectedServer };
    historyData.unshift(entry);
    historyData = historyData.slice(0, 100);
    localStorage.setItem('historyData', JSON.stringify(historyData));
    updateStats();
  }, 5000);
}

// ─── TIMER ───
function updateTimer() {
  var newPeriod = getPeriod();
  document.getElementById('timer').textContent = String(getRemainingSeconds()).padStart(2, '0');
  document.getElementById('period').textContent = newPeriod.slice(-5);
  if (newPeriod !== currentPeriod) {
    currentPeriod = newPeriod;
    lastPredictedPeriod = '';
    setTimeout(function() { runAutoPrediction(currentPeriod); }, 100);
  }
}

// ─── STATS ───
function updateStats() {
  var completed = historyData.filter(function(h) { return h.status !== 'PENDING'; });
  var wins = historyData.filter(function(h) { return h.status === 'VICTORY'; }).length;
  var losses = historyData.filter(function(h) { return h.status === 'DEFEAT'; }).length;
  var jackpots = historyData.filter(function(h) { return h.status === 'JACKPOT'; }).length;
  var total = completed.length;
  var rate = total > 0 ? (((wins+jackpots)/total)*100).toFixed(1) : '0.0';
  document.getElementById('totalStat').textContent = total;
  document.getElementById('winStat').textContent = wins;
  document.getElementById('lossStat').textContent = losses;
  document.getElementById('jackpotStat').textContent = jackpots;
  document.getElementById('rateStat').textContent = rate + '%';
}

// ─── RESULT CHECK LOOP ───
async function checkResultsLoop() {
  try {
    var res = await fetch(HISTORY_API);
    var data = await res.json();
    if (!data || !data.data || !data.data.list) return;
    var results = data.data.list;
    var updated = false;
    historyData = historyData.map(function(item) {
      if (item.status !== 'PENDING') return item;
      var r = results.find(function(x) { return x.issueNumber === item.period; });
      if (r) {
        var actualNum = parseInt(r.number, 10);
        var actualSide = actualNum >= 5 ? 'BIG' : 'SMALL';
        updated = true;
        return { period: item.period, predicted: item.predicted, predictedNum: item.predictedNum, server: item.server, actualNum: actualNum, status: item.predictedNum === actualNum ? 'JACKPOT' : item.predicted === actualSide ? 'VICTORY' : 'DEFEAT' };
      }
      return item;
    });
    if (updated) { localStorage.setItem('historyData', JSON.stringify(historyData)); updateStats(); }
  } catch(e) {}
}

// ─── WEBSITE TAB ───
var searchBarForm = document.getElementById('searchBarForm');
var searchInputEl = document.getElementById('searchInput');
var unhideBtnEl = document.getElementById('unhideBtn');
var webviewWrap = document.getElementById('webviewWrap');
var webviewFrame = document.getElementById('webviewFrame');

var savedUrl = localStorage.getItem('lastWebviewUrl');
if (savedUrl) { webviewFrame.src = savedUrl; webviewWrap.classList.remove('hidden'); searchBarForm.classList.add('hidden'); unhideBtnEl.style.display = 'block'; }

searchBarForm.addEventListener('submit', function(e) {
  e.preventDefault();
  var q = searchInputEl.value.trim(); if (!q) return;
  if (!q.startsWith('http://') && !q.startsWith('https://')) {
    q = q.includes('.') && !q.includes(' ') ? 'https://' + q : 'https://www.google.com/search?q=' + encodeURIComponent(q);
  }
  webviewFrame.src = q; webviewWrap.classList.remove('hidden');
  localStorage.setItem('lastWebviewUrl', q);
  searchBarForm.classList.add('hidden'); unhideBtnEl.style.display = 'block'; searchInputEl.value = '';
});
unhideBtnEl.addEventListener('click', function() { searchBarForm.classList.remove('hidden'); unhideBtnEl.style.display = 'none'; });

// ─── INIT ───
function initDashboard() {
  var saved = localStorage.getItem('historyData');
  if (saved) try { historyData = JSON.parse(saved); } catch(e) { historyData = []; }
  selectedServer = localStorage.getItem('selectedServer') || 'server1';
  document.querySelectorAll('.server-card').forEach(function(c) {
    c.className = 'server-card' + (c.dataset.server === selectedServer ? ' ' + serverActiveClasses[selectedServer] : '');
  });
  document.getElementById('dot1').style.display = selectedServer === 'server1' ? 'block' : 'none';
  document.getElementById('dot2').style.display = selectedServer === 'server2' ? 'block' : 'none';
  document.getElementById('dot3').style.display = selectedServer === 'server3' ? 'block' : 'none';
  currentPeriod = getPeriod();
  updateTimer(); updateStats();
  setInterval(updateTimer, 1000);
  setInterval(checkResultsLoop, 5000);
  runAutoPrediction(currentPeriod);
}

if (sessionStorage.getItem('isLoggedIn') === 'true') {
  document.getElementById('bottomNav').classList.remove('hidden');
  showPage('dashboard'); initDashboard();
}
</script>
</body>
</html>
